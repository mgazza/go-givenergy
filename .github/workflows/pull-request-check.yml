name: Pull Request Checks

on:
  pull_request:
    branches:
      - main

jobs:
  code-generation-check:
    name: Verify Code Generation
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Run Code Generation with Docker
        uses: addnab/docker-run-action@v3
        with:
          image: quay.io/goswagger/swagger:latest
          options: --rm -v ${{ github.workspace }}:/workspace -w /workspace
          run: generate client -f givenergy-swagger.yaml

      - name: Check for Generated Changes
        run: |
          if [[ -n "$(git status --porcelain)" ]]; then
            echo "Code generated by go-swagger has changed; DO NOT EDIT!" && exit 1;
          else
            echo "No changes detected in generated code."
          fi
